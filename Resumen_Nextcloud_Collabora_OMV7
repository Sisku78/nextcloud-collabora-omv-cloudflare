
# ImplementaciÃ³n de Nextcloud + Collabora + Cloudflare Tunnel en OMV 7

**Fecha de finalizaciÃ³n:** 2025-04-25 16:59:19

---

## ğŸ§± Infraestructura base

- **Host:** OMV 7 (`192.168.0.98`)
- **Nextcloud:** `192.168.0.241` (macvlan)
- **Collabora:** `192.168.0.242` (macvlan)
- **Cloudflared:** `192.168.0.240` (macvlan)
- **Red Docker macvlan:** `local-network (192.168.0.240/29)`

---

## ğŸŒ Dominios pÃºblicos en Cloudflare Tunnel

- `mycloud.serranos.cloud â†’ https://192.168.0.241:443` (`noTLSVerify: true`)
- `collabora.serranos.cloud â†’ http://192.168.0.242:9980` (`noTLSVerify: true`)
- Rangos privados en Cloudflare Zero Trust:
  - `192.168.0.240/29`
  - `172.17.0.0/16`

---

## âš™ï¸ Ajustes clave en docker-compose.yml

**Contenedor Collabora:**

```yaml
extra_hosts:
  - "mycloud.serranos.cloud:192.168.0.241"
networks:
  collabora-network:
    ipv4_address: 192.168.0.242
```

---

## ğŸ”’ Certificados

- Se usan certificados Let's Encrypt montados en `/etc/letsencrypt:ro`
- Collabora: `ssl.enable: false`, `ssl.termination: true` (terminaciÃ³n externa en Cloudflare)

---

## ğŸ“‚ ConfiguraciÃ³n de coolwsd.xml (resumen)

```xml
<net>
  <listen>0.0.0.0:9980</listen>
  <allow>0.0.0.0/0</allow>
  <allow>::/0</allow>
</net>

<storage>
  <wopi>
    <host allow="true">.*</host>
  </wopi>
</storage>
```

---

## ğŸ§ª Errores detectados y resueltos

- `Requesting address is denied: ::ffff:192.168.0.240`
  - âœ”ï¸ SoluciÃ³n: `<allow>::/0</allow>`
- `WOPI::CheckFileInfo failed`
  - âœ”ï¸ SoluciÃ³n: `extra_hosts` para mycloud.serranos.cloud
- Archivos no abrÃ­an
  - âœ”ï¸ SoluciÃ³n: conexiÃ³n directa y resoluciÃ³n local

---

## ğŸ§¹ Warnings menores que pueden ignorarse

- `coolmount: Operation not permitted`
- `Unknown resource: /data/.ncdata`
- `systemplate is read-only`

---

## âœ… Estado final

- âœ”ï¸ Collabora se comunica correctamente con Nextcloud
- âœ”ï¸ Apertura de `.docx`, `.xlsx` funcional
- âœ”ï¸ Cloudflare Tunnel operativo con seguridad TLS externa
- âœ”ï¸ Sistema totalmente funcional y optimizado

---

ğŸ‰ **Â¡ImplementaciÃ³n exitosa!**
